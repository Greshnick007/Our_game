<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>CounterStrike</title>
	</head>
<body>
<canvas id="canvas">

</canvas>
<script>
var bullets = [];
var points = [];
var Popal = 0;
var Mimo = 0;
var oldX = 0;
var oldY = 0;
var pic  = new Image();
pic.src  = 'bum.png';
var avatar = new Image();
avatar.src = 'avatar.png';
var pistol_img = new Image();
pistol_img.src = 'Pistols.png';
var ralfe_img = new Image();
ralfe_img.src = 'Ralfe.png';
var drob_img = new Image();
drob_img.src = 'Drobash.png';
var canvas = document.getElementById("canvas");
context = canvas.getContext("2d");
var k = 105;
var scoore = 0;
var x_pos = 0;
var down = false;
var PastTime = 0;

var Drob = false;
var Ralfe = false;
var Pistol = true;



function init() {
	//alert('Смена оружия на клавиши: 1 и 2. На основной клавиатуре')
	canvas.width = document.documentElement.clientWidth;
	canvas.height = document.documentElement.clientHeight;
	canvas.onmousemove = mouse_position;
	canvas.onmousedown = mouse_down;
	canvas.onmouseup = mouse_up;
	canvas.onclick = mouse_click;
	document.onkeydown = changeWeapons;
	setInterval(play, 1000 / 50);
}

function play () {
draw ();
drawCursor(oldX, oldY);
if (down == true) {auto_shoot(oldX, oldY);}
}

function draw() {
context.beginPath();
context.fillStyle = "#687F75";
context.fillRect(0, 0, canvas.width, canvas.height);
context.closePath();

	if (x_pos >= canvas.width) {x_pos =0; bullets = [];}
	x_pos+=5;
	michen(x_pos, (canvas.height/2)-50+Math.sin(x_pos/100)*100);
	for (var i=0; i<=bullets.length-1; i++) {
		drawBum(bullets[i][0], bullets[i][1]);
	}
	for (var i=0; i<=points.length-1; i++) {
		points[i][0] +=5;
		drawBum(points[i][0], points[i][1]+Math.sin(x_pos/100)*100);
	}
user_interface();
}

function user_interface() {
	context.beginPath();
	context.strokeStyle = "#1B1FFF";
	if (Pistol == true) {context.fillStyle = "#ccc";}
	else {context.fillStyle = "#fff";}
	context.strokeRect(5,5, 155, 85);
	context.fillRect(5,5, 155, 85);
	context.drawImage(pistol_img, 10, 10);
	context.closePath();
	context.beginPath();
	context.strokeStyle = "#1B1FFF";
	if (Ralfe == true) {context.fillStyle = "#ccc";}
	else {context.fillStyle = "#fff";}
	context.strokeRect(165,5, 155, 85);
	context.fillRect(165,5, 155, 85);
	context.drawImage(ralfe_img, 165, 5);
	context.closePath();
	context.beginPath();
	context.strokeStyle = "#1B1FFF";
	if (Drob == true) {context.fillStyle = "#ccc";}
	else {context.fillStyle = "#fff";}
	context.strokeRect(325,5, 155, 85);
	context.fillRect(325,5, 155, 85);
	context.drawImage(drob_img, 325, 5);
	context.closePath();
	context.beginPath();
	context.strokeStyle = "#1B1FFF";
	context.fillStyle = "#1B1FFF";
	context.arc(85, canvas.height-85, 80, 0, 2 * Math.PI);
	context.fillRect(5,canvas.height-85, canvas.width-15, 80);
	context.fill();
	context.drawImage(avatar, 10, canvas.height-160);
	context.strokeStyle = "#FFF";
	context.font = 'bold 30px sans-serif';
	context.strokeText(scoore, canvas.width/2, canvas.height-35);
	context.strokeText('Попал: '+Popal, 400, canvas.height-35);
	context.strokeText('Мимо: '+Mimo, 900, canvas.height-35);
	context.closePath();

}

function michen (x, y) {
	var k = 200;
	for (var i= 0; i<=9; i++) {
		context.beginPath();
		context.strokeStyle ="#1B1FFF";
		context.fillStyle ="#FFF";
		context.arc(x, y, k, 0, 2*Math.PI);
		context.fill();
		context.stroke();
		context.closePath();
		k = k - 20;
	}
	context.beginPath();
	context.fillStyle ="#1B1FFF";
	context.arc(x, y, 20, 0, 2*Math.PI);
	context.fill();
	context.closePath();
}

function drawCursor(x, y) {
	context.beginPath();
	context.strokeStyle = "#000";
	context.arc(x, y, 16, 0, 2 * Math.PI);
	context.moveTo(x, y-16);
	context.lineTo(x, y+16);
	context.moveTo(x-16, y);
	context.lineTo(x+16, y);
	context.stroke();
	context.closePath();
}

function mouse_position(event) {
    var x = 0;
	var y = 0;
    if (document.attachEvent != null) {
        x = window.event.clientX;
        y = window.event.clientY;
    } else if (!document.attachEvent && document.addEventListener) {
        x = event.clientX;
        y = event.clientY;
    }

	drawCursor(x, y);
	oldX = x;
	oldY = y;
}

function drawBum(x, y) {
	context.beginPath();
    context.drawImage(pic, x-15, y-15);  // Рисуем изображение от точки с координатами 0, 0
	context.closePath();
}


function mouse_down (event) {
	down = true;
}

function mouse_up (event) {
	down = false;
}

function changeWeapons(event) {
	if (event.keyCode == 49) {Pistol = true; Ralfe = false; Drob = false;}
	if (event.keyCode == 50) {Pistol = false; Ralfe = true; Drob = false;}
	if (event.keyCode == 51) {Pistol = false; Ralfe = false; Drob = true;}
}

function auto_shoot(x,y) {
	var d = new Date();
	if (Ralfe == true) {
		if (d.getTime()-PastTime >= 100) {
			shoot(x,y);
			PastTime = d.getTime();
		}
	}
}

function shoot(x,y) {
	var audioMenu = new Audio;
	if (Pistol == true) {audioMenu.src = "Pistol.mp3";}
	if (Ralfe == true) {audioMenu.src = "Ralfe.mp3";}
	drawBum(x, y);
	xc = x_pos;
	yc = (canvas.height/2)-50;
	var d=Math.sqrt(Math.pow(y-yc,2)+Math.pow(x-xc, 2));
	var rez = Math.ceil(d/20);
	if (rez<=10) {
		scoore = scoore + Math.ceil(100/rez);
		if (points.length-1>=29) {
			points.shift();
		}
		points.push([x, y]);
		Popal++;
	} else {
		if (bullets.length-1>=30) {
			bullets.shift();
		}
		bullets.push([x, y]);
		Mimo++;
	}
	audioMenu.play();
}


function mouse_click (event) {
	x = 0; y = 0;
    if (document.attachEvent != null) {
        x = window.event.clientX;
        y = window.event.clientY;
    } else if (!document.attachEvent && document.addEventListener) {
        x = event.clientX;
        y = event.clientY;
    }
	if (Pistol == true) {shoot(x,y);}
	if (Drob == true) {
	for ($i=0; $i<=9; $i++) {
		var audioMenu = new Audio;
		audioMenu.src = "drobovick.mp3";
		drob_x=getRandomInt(x-60, x+60);
		drob_y=getRandomInt(y-60, y+60);
		shoot(drob_x, drob_y);
		audioMenu.play();
	}
	}
}

function getRandomInt(min, max)
{
	return Math.floor(Math.random() * (max - min + 1)) + min;
}


init();
</script>
<style>
body, html {
padding : 0;
margin : 0;
}
#canvas {
cursor : none;
}
</style>
</body>
</html>